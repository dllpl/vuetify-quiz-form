<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
      rel="stylesheet"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <script src="https://cdn.jsdelivr.net/npm/v-mask@2.3.0/dist/v-mask.min.js"></script>
  </head>
  <style>
    .color_primary {
      color: #79b285;
    }
    .theme--light.v-label {
      color: black;
    }
    .v-input--radio-group legend.v-label {
      font-size: 16px;
    }
  </style>
  <body>
    <div id="app">
      <v-app>
        <v-main>
          <v-stepper v-model="step">
            <v-stepper-header>
              <v-stepper-step :complete="step > 1" step="1" color="primary">
                Услуга
              </v-stepper-step>

              <v-divider></v-divider>

              <v-stepper-step :complete="step > 2" step="2" color="primary">
                Запись на дату
              </v-stepper-step>

              <v-divider></v-divider>

              <v-stepper-step :complete="step > 3" step="3" color="primary">
                Контакты
              </v-stepper-step>
            </v-stepper-header>

            <v-stepper-items>
              <v-stepper-content step="1">
                <v-card class="mb-12" flat>
                  <v-card-title
                    >Пожалуйста, выберите ваши варианты</v-card-title
                  >
                  <v-card-text>
                    <v-row>
                      <v-col lg="4" md="4" sm="4" col="6">
                        <v-radio-group v-model="form.category" mandatory>
                          <template v-slot:label>
                            <div>Услуга</div>
                          </template>
                          <v-radio
                            label="Техосмотр"
                            value="Техосмотр"
                          ></v-radio>
                          <v-radio
                            label="Учет в ГИБДД"
                            value="Учет в ГИБДД"
                          ></v-radio>
                        </v-radio-group>
                        <v-alert
                          dense
                          border="left"
                          text
                          color="warning"
                          max-width="345"
                          v-if="errors.find(error => error.type ===
                        'category')"
                        >
                          {{errors.find(error => error.type ==='category').msg}}
                        </v-alert>
                      </v-col>
                      <v-col lg="4" md="4" sm="4" col="6">
                        <v-radio-group v-model="form.typeCar" mandatory>
                          <template v-slot:label>
                            <div>Тип ТС</div>
                          </template>
                          <v-radio
                            label="Легковой автомобиль"
                            value="Легковой автомобиль"
                          ></v-radio>
                          <v-radio
                            label="Грузовой автомобиль"
                            value="Грузовой автомобиль"
                          ></v-radio>
                        </v-radio-group>
                        <v-alert
                          dense
                          border="left"
                          text
                          color="warning"
                          max-width="345"
                          v-if="errors.find(error => error.type ===
                        'typeCar')"
                        >
                          {{errors.find(error => error.type ==='typeCar').msg}}
                        </v-alert>
                      </v-col>
                      <v-col lg="4" md="4" sm="4" col="12">
                        <v-radio-group v-model="form.address" mandatory>
                          <template v-slot:label>
                            <div>Адрес</div>
                          </template>
                          <v-radio
                            label="Казань, ул. Заречная 3а (Константиновка)"
                            value="Казань, ул. Заречная 3а (Константиновка)"
                          ></v-radio>
                          <v-radio
                            label="Казань, ул. Проспект Победы 194 (ТТС)"
                            value="Казань, ул. Проспект Победы 194 (ТТС)"
                          ></v-radio>
                        </v-radio-group>
                        <v-alert
                          dense
                          border="left"
                          text
                          color="warning"
                          max-width="345"
                          v-if="errors.find(error => error.type ===
                        'address')"
                        >
                          {{errors.find(error => error.type ==='address').msg}}
                        </v-alert>
                      </v-col>
                    </v-row>
                  </v-card-text>
                </v-card>
                <v-btn color="primary" @click="nextStep(1,2)"> Далее </v-btn>
              </v-stepper-content>

              <v-stepper-content step="2">
                <v-card class="mb-12" flat>
                  <v-card-title>Выберите дату и время</v-card-title>
                  <v-card-subtitle
                    >Выберите желаемое время, чтобы продолжить бронирование
                    услуги:
                    <strong
                      >{{form.category}}. {{form.typeCar}}. По адресу:
                      {{form.address}}.</strong
                    >
                  </v-card-subtitle>
                  <v-card-text>
                    <v-row>
                      <v-col lg="3" md="6" sm="6" cols="12">
                        <v-date-picker
                          locale="ru-RU"
                          :show-current="false"
                          v-model="form.selectDay"
                          class="mt-4"
                          :min="datePicker.min"
                          :max="datePicker.max"
                          full-width
                        ></v-date-picker>
                      </v-col>
                      <v-col lg="3" md="6" sm="6" cols="12">
                        <v-select
                          v-model="form.selectTime"
                          label="Выберите время"
                          :items="timePicker.times"
                        >
                        </v-select>
                        <v-alert
                          border="left"
                          error-message="123"
                          text
                          color="warning"
                          max-width="345"
                          max-height="50"
                          v-if="errors.find(error => error.type ===
                        'selectTime')"
                        >
                          {{errors.find(error => error.type
                          ==='selectTime').msg}}
                        </v-alert>
                      </v-col>
                    </v-row>
                  </v-card-text>
                </v-card>

                <v-btn color="primary" @click="nextStep(2,3)"> Далее </v-btn>

                <v-btn text @click="step = 1"> Назад </v-btn>
              </v-stepper-content>

              <v-stepper-content step="3">
                <v-card class="mb-12" flat v-if="step === 3">
                  <v-card-title>Заполните контактные данные</v-card-title>
                  <v-card-subtitle
                    >Вы выбрали:
                    <strong>
                      {{form.category}}. {{form.typeCar}}. По адресу:
                      {{form.address}}. На {{form.selectDay}} в
                      {{form.selectTime}}.</strong
                    >
                  </v-card-subtitle>
                  <v-card-text>
                    <v-form ref="formStep3" v-model="valid" lazy-validation>
                      <v-row>
                        <v-col lg="3" md="6" sm="6" cols="12">
                          <v-text-field
                            v-model="name"
                            :rules="nameRules"
                            label="Имя"
                            required
                          ></v-text-field>
                        </v-col>
                        <v-col lg="3" md="6" sm="6" cols="12">
                          <v-text-field
                            v-model="phone"
                            :rules="phoneRules"
                            :counter="16"
                            label="Телефон"
                            v-mask="'+7(###)###-##-##'"
                            type="text"
                            placeholder="+7(___)___-__-__"
                            required
                          ></v-text-field>
                        </v-col>
                      </v-row>
                    </v-form>
                  </v-card-text>
                </v-card>

                <v-btn color="primary" @click="step = 1"> Далее </v-btn>

                <v-btn text @click="step = 2"> Назад </v-btn>
              </v-stepper-content>
            </v-stepper-items>
          </v-stepper>
        </v-main>
      </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

    <script>
      new Vue({
        el: '#app',
        vuetify: new Vuetify({
          theme: {
            themes: {
              light: {
                primary: '#79b285',
              },
            },
          },
        }),
        data() {
          return {
            step: 2,
            datePicker: {
              min: null,
              max: null,
            },
            timePicker: {
              times: [
                '08:00',
                '09:00',
                '10:00',
                '11:00',
                '12:00',
                '13:00',
                '14:00',
                '15:00',
                '16:00',
                '17:00',
              ],
            },
            form: {
              category: null,
              typeCar: null,
              address: null,
              selectDay: null,
              selectTime: null,
            },
            errors: [],
            valid: true,
            name: '',
            nameRules: [(v) => !!v || 'Заполните имя'],
            phone: '',
            phoneRules: [
              (v) => !!v || 'Заполните телефон',
              (v) => (v && v.length >= 16) || 'Внесите все цифры номера',
            ],
          };
        },
        methods: {
          nextStep(from, to) {
            this.validate(from);

            if (!this.errors.length) this.step = to;
          },
          validate(from) {
            this.errors = [];
            switch (from) {
              case 1:
                if (!this.form.category)
                  this.errors.push({
                    type: 'category',
                    msg: 'Выберите категорию',
                  });
                if (!this.form.typeCar)
                  this.errors.push({
                    type: 'typeCar',
                    msg: 'Выберите тип ТС',
                  });
                if (!this.form.address)
                  this.errors.push({
                    type: 'address',
                    msg: 'Выберите адрес',
                  });
                break;
              case 2:
                if (!this.form.selectTime)
                  this.errors.push({
                    type: 'selectTime',
                    msg: 'Выберите время записи',
                  });
            }
          },
          getDate(date) {
            let body = { date };

            this.form.selectDay = date;

            /** Запрос для получении инфы дня в т.ч. доступное время */

            // fetch("/checkdate", {
            //   method: "POST",
            //   headers: {
            //     "Content-Type": "application/json;charset=utf-8",
            //   },
            //   body: JSON.stringify(body),
            // }).then((res) => {
            //   res.json().then((data) => {
            //     console.log(data);
            //   });
            // });
          },
        },
        created() {
          this.datePicker.min = new Date().toISOString().substr(0, 10);
          let nextYearDate = new Date();
          nextYearDate.setFullYear(nextYearDate.getFullYear() + 1);
          this.datePicker.max = nextYearDate.toISOString().substr(0, 10);
        },
        mounted() {
          this.getDate(
            new Date(Date.now() - new Date().getTimezoneOffset() * 60000)
              .toISOString()
              .substr(0, 10)
          );
        },
      });
      Vue.directive('mask', VueMask.VueMaskDirective);
    </script>
  </body>
</html>
